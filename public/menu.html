<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>メニュー</title>

<style>
/* 読み込み中は非表示 */
body.loading { visibility:hidden; }

body {
  margin:0;
  background:#e6d499;
  font-family: Arial, sans-serif;
}

/* タイトル */
.title {
  text-align:center;
  font-size:38px;
  margin-top:40px;
  letter-spacing:6px;
  font-family:"Hiragino Mincho ProN","Yu Mincho",serif;
}

/* メニューグリッド */
.menu-grid {
  width:90%;
  max-width:700px;
  margin:40px auto;
  display:grid;
  grid-template-columns: repeat(2, 1fr);
  gap:20px;
}

/* カードボタン */
.card {
  background:white;
  padding:30px;
  border-radius:14px;
  text-align:center;
  font-size:18px;
  cursor:pointer;
  box-shadow:0 10px 25px rgba(0,0,0,0.2);
  transition:0.2s;
}

.card:hover {
  transform:translateY(-5px);
  box-shadow:0 18px 40px rgba(0,0,0,0.3);
}

/* 管理者専用ボタン */
.admin-only { display:none; }
body.admin .admin-only { display:block; }

/* ログアウトボタン */
.logout {
  width:220px;
  margin:30px auto 50px;
  display:block;
  padding:12px;
  border:none;
  border-radius:8px;
  background:#e63333;
  color:white;
  font-weight:bold;
  cursor:pointer;
  font-size:16px;
  transition:0.2s;
}

.logout:hover { opacity:0.85; }
</style>
</head>

<body class="loading">

<div class="title">メニュー</div>

<div class="menu-grid">
  <div class="card" onclick="move('register.html')">レジ管理</div>
  <div class="card" onclick="move('report.html')">日報管理</div>
  <div class="card" onclick="move('quote.html')">相見積表</div>
  <div class="card" onclick="move('pl.html')">PL</div>
  <div class="card" onclick="move('setting.html')">設定</div>

  <!-- 管理者専用ボタン -->
  <div class="card admin-only" onclick="move('hankanhi.html')">販管費</div>
  <div class="card admin-only" onclick="move('authority.html')">権限管理</div>
</div>

<button class="logout" onclick="logout()">ログアウト</button>

<!-- Firebase & 認証 -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// Firebase設定
const firebaseConfig = {
  apiKey: "AIzaSyACBuhohMmUJc_aQScQGqeLMN8mmsxRFmo",
  authDomain: "liagroup-a1ab1.firebaseapp.com",
  projectId: "liagroup-a1ab1",
  storageBucket: "liagroup-a1ab1.appspot.com",
  messagingSenderId: "361842389207",
  appId: "1:361842389207:web:1a7b92ef9d85b2726a4092"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db   = getFirestore(app);

// ページ遷移
window.move = page => location.href = page;

// ログアウト
window.logout = async () => {
  await signOut(auth);
  location.replace("index.html");
};

// 認証チェック
onAuthStateChanged(auth, async user => {
  if(!user){
    // 未ログインならログイン画面へ
    location.replace("index.html");
    return;
  }

  try{
    const snap = await getDoc(doc(db, "users", user.uid));
    if(snap.exists() && snap.data().role === "admin"){
      document.body.classList.add("admin"); // 管理者専用ボタン表示
    }
  }catch(e){
    console.log("Firestore error:", e);
  }

  // 認証チェック完了 → メニュー表示
  document.body.classList.remove("loading");
});
</script>

</body>
</html>